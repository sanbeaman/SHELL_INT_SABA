package com.sanbeaman.shell.widget{	import com.greensock.TimelineMax;	import com.greensock.TweenMax;	import com.greensock.easing.Linear;	import com.greensock.events.LoaderEvent;	import com.greensock.loading.ImageLoader;	import com.greensock.loading.LoaderMax;	import com.greensock.loading.XMLLoader;	import com.greensock.loading.display.ContentDisplay;		import flash.display.Sprite;			public class BodyImageCascade extends BodyUI	{		private var _displayBack:Sprite;		private var _displayWindow:Sprite;		private var _displayMask:Sprite;						private var _galleryLoader:LoaderMax;				private var _shellPath:String;				private var _galleryPath:String;				private var _galleryTweenArray:Array;		private var _galleryArray:Array;		private var _galleryArray2:Array;		private var _displayWidth:Number;		private var _displayHeight:Number;						private var _startY:Number = -160;						private var  _galleryTL:TimelineMax;		public function BodyImageCascade()		{			super();		}		public function init(displayWidth:Number,displayHeight:Number,shellPath:String,imgList:XMLList):void		{						this.type = "bodyimagecascade";					_shellPath = shellPath;									_displayWidth = displayWidth;			_displayHeight = displayHeight;						_displayBack = new Sprite();						_displayWindow = new Sprite();						_displayMask = new Sprite();			_displayMask.graphics.beginFill(0x000000,1);			_displayMask.graphics.drawRect(0,0,_displayWidth,_displayHeight);			_displayMask.graphics.endFill();						this.addChild(_displayBack);			_displayBack.addChild(_displayWindow);			this.addChild(_displayMask);			_displayBack.mask = _displayMask;			_buildImageCascade(imgList);						//_buildImageLoader(imgList);		}		private function _buildImageCascade(imgXML:XMLList):void		{						var lmax:String = imgXML.@name;			trace('lmax - '+ lmax);			_galleryLoader = LoaderMax.getLoader(lmax);			_galleryLoader.addEventListener(LoaderEvent.COMPLETE, _gallerMaxComplete);						_galleryArray = _galleryLoader.getChildren(true,true);			_galleryLoader.load();								}		private function _gallerMaxComplete(event:LoaderEvent):void {			_galleryTweenArray = new Array();						// = event.target.content;			for (var i:int = 0; i < _galleryArray.length; i++){				var lmaxName:String = _galleryArray[i].name;				trace('_galleryArray[i].name = ' + lmaxName);				var loadedImage:ContentDisplay = LoaderMax.getContent(lmaxName);				loadedImage.x = 0;				loadedImage.y = _startY;								_displayWindow.addChild(loadedImage);				_galleryTweenArray.push(loadedImage);							}			_startImageCycle();					}		private function _buildImageLoader(imgXML:XMLList):void		{						_galleryTweenArray = new Array();			_galleryArray = new Array();						_galleryLoader = new LoaderMax({name:"mainQueue",onComplete:_galleryLoaderCompleteHandler, onChildComplete:_imageCompleteHandler});			for each (var item:XML in imgXML) 			{ 								var ipath:String = _shellPath + item.@url;				var iLoader:ImageLoader = new ImageLoader(ipath,{name:item.@id,estimatedBytes:item.@estimatedBytes,load:"true",width:item.@width,height:item.@height,scaleMode:item.@scaleMode});				_galleryLoader.append(iLoader);			}							_galleryLoader.load();							}				private function _galleryLoaderCompleteHandler(event:LoaderEvent):void {			_startImageCycle();									}				private function _startImageCycle():void		{			_galleryTL = new TimelineMax({paused:false,repeat:-1});			_galleryTL.appendMultiple(TweenMax.allFromTo(_galleryTweenArray,6,{y:_startY},{y:_displayHeight,ease:Linear.easeNone},3));			}		private function _imageCompleteHandler(event:LoaderEvent):void {			var loadedImage:ContentDisplay = event.target.content;			//loadedImage.alpha = 0;					loadedImage.x = 0;			loadedImage.y = _startY;						_displayWindow.addChild(loadedImage);			_galleryArray.push(loadedImage);								}				public function startAnim():void		{			_galleryTL.play();		}		public function stopAnim():void		{			_galleryTL.stop();		}	}}